Настройка шлюза. 

Как обычно создаём виртуальную машину.
Вся мякотка тут в настройке сети.

Для первого интерфейса выбираем "СЕТЬ NAT", для второго - "Внутренняя сеть" и вводим имя сети.

Имя сети можно ввести любое. 

![image](https://user-images.githubusercontent.com/65608414/102971610-7daf3500-451b-11eb-9401-fc9b91d4d033.png)

После этого устанавливаем виртуальную машину для сервера. Тут я думаю, вы справитесь. Во время установки дебиан спросит, какой интерфейс использовать, для установки - выбирайте первый. 

При установке также спросит имя домена. ИМЯ ДОМЕНА ПРИДУМЫВАЕМ САМИ. biba.ru boba.com biba.boba pupa.lupa - примеры доменных имен

После установки сервера, логинимся, становимся рутом

`su -`

Настраиваем имена сетевых интерфейсов. 

Нам понадобятся mac-адреса наших сетевых адаптеров.

Пишем команду 

`ip l`

и переписываем/запоминаем оттуда mac-адреса. Скорее всего будет примерно так:

![image](https://user-images.githubusercontent.com/65608414/118691089-27bc9000-b822-11eb-9042-74125bd114ba.png)

Если всё делали, как я писал выше и как рассказывал Алексеевский на лекции, то первым будет loopback-интерфейс. Вторым - интерфейс, который у нас будет для "интернета" и третьим - интерфейс для локальной сети. 

Выписываем куда-нибудь эти mac-адреса. Желтый - mac-адрес интерфейса для интернета. Зелёный - для локальной сети.

Теперь преименуем наши интерфейсы. Для этого создадим файл и откроем его для редактирования следующей командой:

`nano /etc/udev/rules.d/70-netif-names.rules`

Имя файла 70-netif-names.rules можете придумать любое, главное, чтобы оно обязательно начиналось с 70- и заканчивалось на .rules

Итак. Пишем в этот файл 2 строки, которые переименуют наши интерфейсы:

SUBSYSTEM=="net",ACTION=="add",ATTR{address}=="ваш mac-адрес интерфейса для инета",ATTR{type}=="1",NAME="wan0"

SUBSYSTEM=="net",ACTION=="add",ATTR{address}=="ваш mac-адрес интерфейса для инета",ATTR{type}=="1",NAME="lan0"

ПРИМЕР (НЕ КОПИРУЙТЕ ЕГО СЕБЕ, У ВАС ПОЛЮБОМУ БУДУТ ДРУГИЕ MAC-адреса):

SUBSYSTEM=="net",ACTION=="add",ATTR{address}=="08:00:27:4D:C7:DD",ATTR{type}=="1",NAME="wan0"
SUBSYSTEM=="net",ACTION=="add",ATTR{address}=="08:00:27:2F:D5:85",ATTR{type}=="1",NAME="lan0"

Сохраняем файл ctrl+O, затем ctrl+X

Далее нам необходимо узнать текущий ip адрес нашего сервера. Для этого пишем команду 

`ip a`

и в выводе этой команды, у второго интерфейса (начинается с 2: ) ищем слово inet и вот после него идёт ip адрес. 

У меня он вот такой (после всех настроек у вас может быть другим):

![image](https://user-images.githubusercontent.com/65608414/118692982-0f4d7500-b824-11eb-94a2-34e260099eb6.png)

запоминаем/записываем эти циферки.

После того, как проделали эти манипуляции, идём в файл /etc/network/interfaces

nano /etc/network/interfaces и приводим его к следующему виду:

Тут есть один важный момент. То, что я выделил красным - у вас ДОЛЖНО быть другим. Так как это именно мои настройки. Помните, запоминали текущий ip сервера? Так вот, он был например 10.0.2.19/24. В принципе оно нас устраивает и в таком виде. Но лучше немного уменьшить адрес. Пусть будет 10.0.2.2 или 10.0.2.3, в целом разницы никакой. Лучше берите любую цифру от 2 до 10

ПРИМЕР: Итак, если ip у нас был 10.0.2.19/24, то мы пишем вместо красных цифр в блоке, где описываем интерфейс wan0 примерно следующее (НО НЕ ОБЯЗАТЕЛЬНО ЭТО):

address 10.0.2.2/24

gateway 10.0.2.1

Вот так выглядит у меня (если списали вот прям с этой картинки и ничего не заработало - сами виноваты, я предупреждал :) ) :
![image](https://user-images.githubusercontent.com/65608414/118693440-7834ed00-b824-11eb-91f1-952a3c99c4c1.png)

Сохраняем файл ctrl+O, затем ctrl+X и перезагружаем машину. 
Если после перезагрузки всё заработало - ты красавчик и молодец. Если нет - стоит проверить файлы /etc/udev/rules.d/70-netif-names.rules и /etc/network/interfaces на наличие опечаток и всякого такого. 

Далее разрешим нашей систему пропускать через себя сетевые пакеты. Для этого отредактируем файл /etc/sysctl.conf

`nano /etc/sysctl.conf`

Найдем там строку: 
#net.ipv4.ip_forward=1
и раскомментируем её, убрав решётку из начала строки, чтобы осталось просто:
net.ipv4.ip_forward=1

Сохраняем файл ctrl+O, затем ctrl+X

пишем команду:

`sysctl -p`

Оно нам должно написать:
net.ipv4.ip_forward=1
Если да - всё отлично.

Переходим к следующему шагу.
